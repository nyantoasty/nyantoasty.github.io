<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Pattern-to-Firestore Generator</title>
    <link rel="icon" type="image/png" href="/assets/icons/yarn-ball-icon.png">
    <!-- Chosen Palette: Warm Neutral -->
    <!-- Application Structure Plan: Interactive prompt builder for generating Firestore write operations instead of JSON files. Creates direct database integration patterns with sharing capabilities built-in. -->
    <!-- Visualization & Content Choices: Report Info: Pattern conversion -> Goal: Generate Firestore operations -> Presentation: Form builder with copy-to-clipboard for database operations -> Interaction: Text input, operation type selection, permission settings -> Justification: Eliminates JSON file management, enables real-time testing, supports pattern sharing from day one. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdfaf6;
            color: #4a4a4a;
        }
        .mono {
            font-family: 'Roboto Mono', monospace;
            background-color: #f0e9e1;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .code-block {
            background-color: #f7f2ec;
            border: 1px solid #e4dace;
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            color: #5c5c5c;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid transparent;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .tab-button.active {
            background-color: #ffffff;
            color: #9a3412;
            border-color: #e4dace;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .tab-button:not(.active):hover {
            background-color: #f7f2ec;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .json-key {
            color: #c2410c;
        }
        .json-string {
            color: #1e6043;
        }
        .json-number {
            color: #1d4ed8;
        }
        .json-boolean {
            color: #7c2d12;
        }
        .tooltip {
            visibility: hidden; opacity: 0;
            transition: opacity 0.2s;
            position: absolute; z-index: 10;
            bottom: 125%; left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background-color: #2a2a2a;
            color: #f0e9e1;
            font-size: 0.875rem;
            white-space: nowrap;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tooltip-trigger:hover .tooltip {
            visibility: visible; opacity: 1;
        }
        .tooltip::after {
            content: ""; position: absolute;
            top: 100%; left: 50%;
            margin-left: -5px; border-width: 5px;
            border-style: solid;
            border-color: #2a2a2a transparent transparent transparent;
        }
    </style>
</head>
<body class="antialiased">

    <div class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-2">AI Pattern-to-Firestore Generator</h1>
            <p class="text-lg text-gray-600">Generate prompts for AI to create patterns directly in Firestore with sharing capabilities.</p>
        </header>

        <main class="space-y-16">
            
            <section id="prompt-builder" class="bg-white p-6 sm:p-8 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-4">Prompt Builder</h2>

                <div class="space-y-8">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Step 1: Choose Your Pattern Format</h3>
                        <div id="pattern-type-selector" class="flex items-center space-x-2 bg-stone-100 p-1 rounded-lg max-w-xs">
                            <button data-type="text" class="w-1/2 tab-button active">Text</button>
                            <button data-type="image" class="w-1/2 tab-button">Image</button>
                        </div>
                        <div id="image-instructions" class="hidden mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg text-amber-800">
                            <h4 class="font-semibold mb-2">Image-Based Pattern Workflow</h4>
                            <p class="text-sm">This is a two-step process:</p>
                            <ol class="list-decimal list-inside mt-2 space-y-1 text-sm">
                                <li><strong>Transcribe Image:</strong> Use an AI with vision capabilities. Give it your image and use the prompt: <span class="mono text-xs">"Please transcribe the text from this image of a pattern."</span></li>
                                <li><strong>Generate JSON:</strong> Copy the transcribed text from the AI and paste it into the text area in Step 2 below.</li>
                            </ol>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Step 2: Pattern Settings</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-600 mb-2">Pattern Visibility</label>
                                <select id="pattern-visibility" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-300 focus:border-orange-400">
                                    <option value="private">Private (only you)</option>
                                    <option value="shared">Shared (specific users)</option>
                                    <option value="public">Public (everyone can view)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-600 mb-2">Craft Type</label>
                                <select id="craft-type" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-300 focus:border-orange-400">
                                    <option value="knitting">Knitting</option>
                                    <option value="crochet">Crochet</option>
                                    <option value="tunisian">Tunisian Crochet</option>
                                    <option value="weaving">Weaving</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Step 3: Paste Your Pattern Text</h3>
                        <p class="text-sm text-gray-500 mb-3">Paste the full, raw text of your pattern here. If you transcribed it from an image, paste that text.</p>
                        <textarea id="pattern-input" rows="10" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-300 focus:border-orange-400 transition" placeholder="Paste pattern text here..."></textarea>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Step 4: Generate Firestore Integration Prompt</h3>
                        <p class="text-sm text-gray-500 mb-3">This generates a prompt for AI to create Firestore write operations instead of JSON files. The pattern will be stored directly in the database with sharing capabilities.</p>
                        <div class="relative">
                            <button id="copy-prompt-button" class="absolute top-3 right-3 bg-white hover:bg-stone-100 text-gray-600 font-medium py-1 px-3 border border-gray-300 rounded-md text-sm transition-colors">
                                <span id="copy-default">Copy</span>
                                <span id="copy-success" class="hidden">Copied!</span>
                            </button>
                            <div id="prompt-output" class="code-block text-sm">Select a pattern type and paste text to generate the prompt.</div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="reference" class="bg-white p-6 sm:p-8 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-4">Technical Reference</h2>

                <div class="space-y-8">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">JSON Structure Overview</h3>
                        <div class="code-block">
<pre>{
  <span class="json-key">"metadata"</span>: { ... }, <span class="text-gray-400">// Pattern info</span>
  <span class="json-key">"glossary"</span>: { ... }, <span class="text-gray-400">// Stitch definitions</span>
  <span class="json-key">"instructions"</span>: [ ... ] <span class="text-gray-400">// Array of step objects</span>
}</pre>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">The `instruction` Object Schema</h3>
                        <p class="text-sm text-gray-500 mb-3">Each object in the `instructions` array follows this schema. Hover over properties for details.</p>
                        <div class="code-block">
<pre>{
  <span class="relative tooltip-trigger"><span class="json-key">"step"</span><span class="tooltip">Use for a single, unique step.</span></span>: <span class="json-number">63</span>,
  <span class="relative tooltip-trigger"><span class="json-key">"stepRange"</span><span class="tooltip">Use to group multiple identical steps.</span></span>: [<span class="json-number">4</span>, <span class="json-number">62</span>],
  <span class="relative tooltip-trigger"><span class="json-key">"stepType"</span><span class="tooltip">Optional: 'even' or 'odd' to filter steps within a range.</span></span>: <span class="json-string">"even"</span>,
  <span class="relative tooltip-trigger"><span class="json-key">"type"</span><span class="tooltip">The type of step, e.g., 'Row' or 'Round'.</span></span>: <span class="json-string">"Row"</span>,
  <span class="relative tooltip-trigger"><span class="json-key">"side"</span><span class="tooltip">Optional: 'RS', 'WS', or omit if not applicable.</span></span>: <span class="json-string">"RS"</span>,
  <span class="relative tooltip-trigger"><span class="json-key">"increase"</span><span class="tooltip">Net change in stitch count for this step.</span></span>: <span class="json-number">2</span>,
  <span class="relative tooltip-trigger"><span class="json-key">"totalStitches"</span><span class="tooltip">The final stitch count after this step is completed.</span></span>: <span class="json-number">139</span>,
  <span class="relative tooltip-trigger"><span class="json-key">"dynamicChunks"</span><span class="tooltip">Set to true if parts of the row (e.g., 'k to marker') need to be calculated by the app.</span></span>: <span class="json-boolean">false</span>,
  <span class="relative tooltip-trigger"><span class="json-key">"displayText"</span><span class="tooltip">The original, human-readable instruction text.</span></span>: <span class="json-string">"&lt;b&gt;Row 63...&lt;/b&gt;"</span>,
  <span class="relative tooltip-trigger"><span class="json-key">"chunks"</span><span class="tooltip">An array of logical sections of the pattern step.</span></span>: [ { ... } ]
}</pre>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Examples</h3>
                        <div class="flex items-center space-x-2 mb-4 p-1 bg-stone-100 rounded-lg max-w-md">
                            <button id="tab-ex1" class="tab-button w-1/2 active">Unique Row</button>
                            <button id="tab-ex2" class="tab-button w-1/2">Grouped Rows</button>
                        </div>

                        <div id="content-ex1" class="tab-content active space-y-3">
                            <p class="text-sm text-gray-600"><strong>Pattern says:</strong> Row 63 (RS): k3, kfb, (yo, ssk, k5, k2tog, yo, k1) 6 times, k3, m1L, k1, m1R, k3, ...</p>
                            <p class="text-sm text-gray-500">This becomes a single object with a fully defined `chunks` array.</p>
                            <div class="code-block">
<pre>{
  <span class="json-key">"step"</span>: <span class="json-number">63</span>, <span class="json-key">"type"</span>: <span class="json-string">"Row"</span>, <span class="json-key">"side"</span>: <span class="json-string">"RS"</span>, <span class="json-key">"increase"</span>: <span class="json-number">2</span>, <span class="json-key">"totalStitches"</span>: <span class="json-number">139</span>,
  <span class="json-key">"displayText"</span>: <span class="json-string">"<b>Row 63 (RS):</b> ..."</span>,
  <span class="json-key">"chunks"</span>: [
    { <span class="json-key">"name"</span>: <span class="json-string">"Edge & Inc"</span>, <span class="json-key">"pattern"</span>: [<span class="json-string">"k3"</span>, <span class="json-string">"kfb"</span>] },
    { <span class="json-key">"name"</span>: <span class="json-string">"Lace 1 Left"</span>, <span class="json-key">"repeats"</span>: <span class="json-number">6</span>, <span class="json-key">"pattern"</span>: [<span class="json-string">"yo"</span>, <span class="json-string">"ssk"</span>, <span class="json-string">"k5"</span>, ...] },
    { <span class="json-key">"name"</span>: <span class="json-string">"Center Panel"</span>, <span class="json-key">"pattern"</span>: [<span class="json-string">"k3"</span>, <span class="json-string">"m1L"</span>, <span class="json-string">"k1"</span>, ...] },
    { <span class="json-key">"name"</span>: <span class="json-string">"Lace 1 Right"</span>, <span class="json-key">"repeats"</span>: <span class="json-number">6</span>, <span class="json-key">"pattern"</span>: [<span class="json-string">"yo"</span>, <span class="json-string">"ssk"</span>, <span class="json-string">"k5"</span>, ...] },
    { <span class="json-key">"name"</span>: <span class="json-string">"Inc & Edge"</span>, <span class="json-key">"pattern"</span>: [<span class="json-string">"kfb"</span>, <span class="json-string">"k3"</span>] }
  ]
}</pre>
                            </div>
                        </div>

                        <div id="content-ex2" class="tab-content space-y-3">
                            <p class="text-sm text-gray-600"><strong>Pattern says:</strong> Rows 3-61 (Odd, RS): ...k to marker... and Rows 4-62 (Even, WS): ...purl to last 3...</p>
                            <p class="text-sm text-gray-500">These are grouped into two objects using `stepRange` and `stepType`. They use `dynamicChunks: true` because parts of the row change with each repeat.</p>
                            <div class="code-block">
<pre>[
  {
    <span class="json-key">"stepRange"</span>: [<span class="json-number">3</span>, <span class="json-number">61</span>], <span class="json-key">"stepType"</span>: <span class="json-string">"odd"</span>, <span class="json-key">"side"</span>: <span class="json-string">"RS"</span>, <span class="json-key">"increase"</span>: <span class="json-number">4</span>,
    <span class="json-key">"dynamicChunks"</span>: <span class="json-boolean">true</span>,
    <span class="json-key">"displayText"</span>: <span class="json-string">"<b>Odd Rows 3-61 (RS):</b> k3, kfb, k to marker..."</span>
  },
  {
    <span class="json-key">"stepRange"</span>: [<span class="json-number">4</span>, <span class="json-number">62</span>], <span class="json-key">"stepType"</span>: <span class="json-string">"even"</span>, <span class="json-key">"side"</span>: <span class="json-string">"WS"</span>, <span class="json-key">"increase"</span>: <span class="json-number">0</span>,
    <span class="json-key">"dynamicChunks"</span>: <span class="json-boolean">true</span>,
    <span class="json-key">"displayText"</span>: <span class="json-string">"<b>Even Rows 4-62 (WS):</b> k3, purl to last 3, k3."</span>
  }
]</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const patternTypeSelector = document.getElementById('pattern-type-selector');
    const imageInstructions = document.getElementById('image-instructions');
    const patternInput = document.getElementById('pattern-input');
    const promptOutput = document.getElementById('prompt-output');
    const copyButton = document.getElementById('copy-prompt-button');

    const basePrompt = `# AI Prompt: Convert Craft Pattern to Firestore Write Operations

## 1. Goal & Context

You are an expert at converting fiber arts patterns into structured data for a web application. Instead of generating JSON files, you'll create **Firestore write operations** that store the pattern directly in a database with sharing capabilities.

## 2. Pattern Settings
Craft Type: {{CRAFT_TYPE}}
Visibility: {{VISIBILITY}}
User ID: {{USER_ID}} (the person creating this pattern)

## 3. Input Pattern Text
\`\`\`
{{PATTERN_TEXT}}
\`\`\`

## 4. Required Output: Firestore Write Operations

Generate the JavaScript code to write this pattern to Firestore using our schema:

\`\`\`javascript
// Pattern creation with sharing support
async function createPatternInFirestore() {
  const patternId = generateUniqueId();
  const userId = '{{USER_ID}}';
  
  // Main pattern document
  const patternData = {
    // Metadata
    id: patternId,
    name: "Pattern Name Here",
    author: "Author Name",
    craft: "{{CRAFT_TYPE}}",
    difficulty: "intermediate", // beginner, intermediate, advanced
    
    // Ownership and sharing
    createdBy: userId,
    createdAt: new Date(),
    updatedAt: new Date(),
    visibility: "{{VISIBILITY}}",
    
    // Pattern structure
    metadata: {
      maxSteps: 117,
      estimatedTime: "20 hours",
      materials: ["materials list here"]
    },
    
    glossary: {
      "k": {
        "name": "Knit",
        "description": "Knit stitch.",
        "stitchIndex": 1
      }
      // ... complete glossary based on stitches used
    },
    
    steps: [
      {
        "step": 1,
        "section": "Setup",
        "side": "rs",
        "startingStitchCount": 9,
        "endingStitchCount": 11,
        "chunks": [
          {
            "id": "edge-left",
            "type": "static",
            "instructions": [
              { "stitch": "k", "count": 3 }
            ]
          }
          // ... more chunks
        ]
      }
      // ... more steps using stepRange for repeating patterns
    ],
    
    // Analytics and sharing
    shareCount: 0,
    viewCount: 0,
    forkCount: 0,
    tags: ["tag1", "tag2"],
    exportCount: 0
  };
  
  // Write to Firestore
  await db.collection('patterns').doc(patternId).set(patternData);
  
  // Create access record for creator
  await db.collection('pattern_access').doc(patternId + '_' + userId).set({
    patternId: patternId,
    userId: userId,
    grantedBy: userId,
    permission: 'admin',
    grantedAt: new Date(),
    status: 'active',
    shareReason: 'pattern_creator'
  });
  
  console.log('Pattern created with ID:', patternId);
  return patternId;
}
\`\`\`

## 5. Key Requirements

### Chunk Architecture
- Use **stepRange** for repeating patterns (e.g., rows 3-61 odd)
- Break instructions into logical **chunks** (edge, center, increases)
- Use **dynamic chunks** for "k to marker" or "p to last 3" scenarios
- Each chunk needs an **id** and **type** (static, dynamic, repeat)

### Stitch Index
- Every stitch in glossary needs **stitchIndex** (how many needle positions it creates)
- k=1, kfb=2, k2tog=1, yo=1, pm=0, etc.

### Step Counting
- **startingStitchCount** and **endingStitchCount** for each step
- Use **stitchCountChange** for stepRanges (+4, -2, 0)

### Sharing Ready
- Pattern includes all metadata for sharing
- Visibility setting determines access level
- Tags help with pattern discovery

Generate the complete Firestore write operations for this pattern.`;

    function updatePrompt() {
        const patternText = patternInput.value.trim();
        const visibility = document.getElementById('pattern-visibility').value;
        const craftType = document.getElementById('craft-type').value;
        
        if (patternText) {
            const fullPrompt = basePrompt
                .replace(/{{PATTERN_TEXT}}/g, patternText)
                .replace(/{{VISIBILITY}}/g, visibility)
                .replace(/{{CRAFT_TYPE}}/g, craftType)
                .replace(/{{USER_ID}}/g, 'current_user_id'); // This would be filled by the app
            promptOutput.textContent = fullPrompt;
        } else {
            promptOutput.textContent = 'Configure settings and paste pattern text to generate the prompt.';
        }
    }

    patternTypeSelector.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            const type = e.target.dataset.type;
            patternTypeSelector.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            
            if (type === 'image') {
                imageInstructions.classList.remove('hidden');
            } else {
                imageInstructions.classList.add('hidden');
            }
        }
    });

    patternInput.addEventListener('input', updatePrompt);
    document.getElementById('pattern-visibility').addEventListener('change', updatePrompt);
    document.getElementById('craft-type').addEventListener('change', updatePrompt);

    copyButton.addEventListener('click', () => {
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(promptOutput.textContent).then(() => {
                const defaultSpan = document.getElementById('copy-default');
                const successSpan = document.getElementById('copy-success');
                defaultSpan.classList.add('hidden');
                successSpan.classList.remove('hidden');
                setTimeout(() => {
                    defaultSpan.classList.remove('hidden');
                    successSpan.classList.add('hidden');
                }, 2000);
            });
        } else {
            const textArea = document.createElement('textarea');
            textArea.value = promptOutput.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Prompt copied to clipboard!');
        }
    });
    
    const tabButtons = document.querySelectorAll('.tab-button[id^="tab-"]');
    const tabContents = document.querySelectorAll('.tab-content[id^="content-"]');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.id.replace('tab-', '');
            
            tabButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            tabContents.forEach(content => {
                if (content.id === `content-${tabId}`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        });
    });
});
</script>
</body>
</html>

